<!DOCTYPE html>
<html lang="en-us">
<head>
<meta charset="utf-8">
<meta name="description" content="">
<meta name="generator" content="Hugo 0.62.2" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/css/style.css" type="text/css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,700" type="text/css">
<link rel="alternate" href="/index.xml" type="application/rss+xml" title="Longg`s Site">
<title>tortoise学习笔记 - Longg`s Site</title>
</head>
<body>

<header>
  <div class="container clearfix">
    <a class="path" href="https://ghlonghan007.github.io/">[Longg`s Site]</a>
    <span class="caret"># _</span>
    <div class="right">
      
    </div>
  </div>
</header>

<div class="container">


<main role="main" class="article">
  
<article class="single" itemscope itemtype="http://schema.org/BlogPosting">
  <div class="meta">

    <span class="key">published on</span>
    <span class="val"><time itemprop="datePublished" datetime="2020-05-28">May 28, 2020</time></span>



  </div>
  <h1 class="headline" itemprop="headline">tortoise学习笔记</h1>
  <section class="body" itemprop="articleBody">
    <p>一个异步ORM 支持MySQL</p>
<p>使用分3步:</p>
<p>1.定义一个模型</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">tortoise.models</span> <span class="kn">import</span> <span class="n">Model</span>
<span class="kn">from</span> <span class="nn">tortoise</span> <span class="kn">import</span> <span class="n">fields</span>

<span class="k">class</span> <span class="nc">Tournament</span><span class="p">(</span><span class="n">Model</span><span class="p">)</span><span class="p">:</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">IntField</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="p">)</span>
</code></pre></div><p>2.初始化orm,将模型注册到上面</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">tortoise</span> <span class="kn">import</span> <span class="n">Tortoise</span><span class="p">,</span> <span class="n">run_async</span>

<span class="n">async</span> <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="p">)</span><span class="p">:</span>
    <span class="n">await</span> <span class="n">Tortoise</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
        <span class="n">db_url</span><span class="o">=</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">sqlite://db.sqlite3</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="n">modules</span><span class="o">=</span><span class="p">{</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">models</span><span class="s1">&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">app.models</span><span class="s1">&#39;</span><span class="p">]</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="c1"># Generate the schema</span>
    <span class="n">await</span> <span class="n">Tortoise</span><span class="o">.</span><span class="n">generate_schemas</span><span class="p">(</span><span class="p">)</span>

<span class="c1"># run_async is a helper function to run simple async Tortoise scripts.</span>
<span class="n">run_async</span><span class="p">(</span><span class="n">init</span><span class="p">(</span><span class="p">)</span><span class="p">)</span>
</code></pre></div><p>3.使用ORM接口 自带很多方便的接口</p>
<pre><code class="language-python " data-lang="python "># Create instance by save
tournament = Tournament(name='New Tournament')
await tournament.save()

# Or by .create()
await Tournament.create(name='Another Tournament')

# Now search for a record
tour = await Tournament.filter(name__contains='Another').first()
print(tour.name)
</code></pre>
  </section>
</article>

</main>

</div>

<footer>
  <div class="container">
    <span class="copyright">&copy; 2021 Longg`s Site - <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></span>
  </div>
</footer>

</body>
</html>

